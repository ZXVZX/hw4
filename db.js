const sqlite3 = require('sqlite3').verbose();
const fs = require('fs');
const path = require('path');

const dbDir = path.join(__dirname, 'db');
const dbPath = path.join(dbDir, 'sqlite.db');

if (!fs.existsSync(dbDir)) {
  fs.mkdirSync(dbDir);
}

const db = new sqlite3.Database(dbPath);

const data = [
  { date: '2004年6月', price: 27.75 },
  { date: '2004年7月', price: 32.33 },
  { date: '2004年8月', price: 28.33 },
  { date: '2004年9月', price: 23.25 },
  { date: '2004年10月', price: 28 },
  { date: '2004年11月', price: 39.17 },
  { date: '2005年6月', price: 26 },
  { date: '2005年7月', price: 34.55 },
  { date: '2005年8月', price: 32.11 },
  { date: '2005年9月', price: 32.78 },
  { date: '2005年10月', price: 31 },
  { date: '2005年11月', price: 36.67 },
  { date: '2006年6月', price: 45 },
  { date: '2006年7月', price: 34.17 },
  { date: '2006年8月', price: 30.22 },
  { date: '2006年9月', price: 27.67 },
  { date: '2006年10月', price: 21.78 },
  { date: '2006年11月', price: 32 },
  { date: '2007年6月', price: 25 },
  { date: '2007年7月', price: 22.61 },
  { date: '2007年8月', price: 27.44 },
  { date: '2007年9月', price: 25.44 },
  { date: '2007年10月', price: 31 },
  { date: '2007年11月', price: 31.17 },
  { date: '2008年5月', price: 35 },
  { date: '2008年6月', price: 32.67 },
  { date: '2008年7月', price: 23.05 },
  { date: '2008年8月', price: 18.5 },
  { date: '2008年9月', price: 23 },
  { date: '2008年10月', price: 22.33 },
  { date: '2008年11月', price: 18.25 },
  { date: '2009年6月', price: 47.5 },
  { date: '2009年7月', price: 33.92 },
  { date: '2009年8月', price: 25.08 },
  { date: '2009年9月', price: 33.5 },
  { date: '2009年10月', price: 31.93 },
  { date: '2009年11月', price: 40.91 },
  { date: '2010年7月', price: 25 },
  { date: '2010年8月', price: 29.17 },
  { date: '2010年9月', price: 35.62 },
  { date: '2010年10月', price: 49.67 },
  { date: '2010年11月', price: 69.83 },
  { date: '2011年6月', price: 90.67 },
  { date: '2011年7月', price: 39 },
  { date: '2011年8月', price: 33.33 },
  { date: '2011年9月', price: 46.8 },
  { date: '2011年10月', price: 44.17 },
  { date: '2011年11月', price: 49.17 },
  { date: '2012年6月', price: 61.25 },
  { date: '2012年7月', price: 49.89 },
  { date: '2012年8月', price: 57.06 },
  { date: '2012年9月', price: 60.78 },
  { date: '2012年10月', price: 51.75 },
  { date: '2012年11月', price: 59.17 },
  { date: '2013年5月', price: 100 },
  { date: '2013年6月', price: 69.89 },
  { date: '2013年7月', price: 50.58 },
  { date: '2013年8月', price: 44.25 },
  { date: '2013年9月', price: 49.61 },
  { date: '2013年10月', price: 44.54 },
  { date: '2013年11月', price: 70.92 },
  { date: '2014年5月', price: 116.67 },
  { date: '2014年6月', price: 79.33 },
  { date: '2014年7月', price: 53.11 },
  { date: '2014年8月', price: 52.92 },
  { date: '2014年9月', price: 55.17 },
  { date: '2014年10月', price: 61.33 },
  { date: '2014年11月', price: 69 },
  { date: '2015年5月', price: 91.67 },
  { date: '2015年6月', price: 62.92 },
  { date: '2015年7月', price: 28.92 },
  { date: '2015年8月', price: 47.92 },
  { date: '2015年9月', price: 54.16 },
  { date: '2015年10月', price: 61.42 },
  { date: '2015年11月', price: 70.04 },
  { date: '2016年5月', price: 96.67 },
  { date: '2016年6月', price: 65.58 },
  { date: '2016年7月', price: 39.6 },
  { date: '2016年8月', price: 55.45 },
  { date: '2016年9月', price: 39.61 },
  { date: '2016年10月', price: 51.48 },
  { date: '2016年11月', price: 73.15 },
  { date: '2017年5月', price: 100 },
  { date: '2017年6月', price: 46.34 },
  { date: '2017年7月', price: 36.43 },
  { date: '2017年8月', price: 36.93 },
  { date: '2017年9月', price: 32.69 },
  { date: '2017年10月', price: 28.43 },
  { date: '2017年11月', price: 54.88 },
  { date: '2018年5月', price: 61.5 },
  { date: '2018年6月', price: 36.21 },
  { date: '2018年7月', price: 26.07 },
  { date: '2018年8月', price: 29.44 },
  { date: '2018年9月', price: 29.1 },
  { date: '2018年10月', price: 28.34 },
  { date: '2018年11月', price: 38.23 },
  { date: '2019年5月', price: 54.46 },
  { date: '2019年6月', price: 47.2 },
  { date: '2019年7月', price: 30.11 },
  { date: '2019年8月', price: 37.7 },
  { date: '2019年9月', price: 41.08 },
  { date: '2019年10月', price: 37.32 },
  { date: '2019年11月', price: 30.6 },
  { date: '2020年5月', price: 57.58 },
  { date: '2020年6月', price: 35 },
  { date: '2020年7月', price: 26.85 },
  { date: '2020年8月', price: 33.76 },
  { date: '2020年9月', price: 34.34 },
  { date: '2020年10月', price: 30.64 },
  { date: '2020年11月', price: 32.83 },
  { date: '2021年5月', price: 68.92 },
  { date: '2021年6月', price: 34.53 },
  { date: '2021年7月', price: 46.85 },
  { date: '2021年8月', price: 46.05 },
  { date: '2021年9月', price: 37.93 },
  { date: '2021年10月', price: 40.86 },
  { date: '2021年11月', price: 40.26 },
  { date: '2022年5月', price: 87.17 },
  { date: '2022年6月', price: 51.82 },
  { date: '2022年7月', price: 41.97 },
  { date: '2022年8月', price: 33.97 },
  { date: '2022年9月', price: 32.65 },
  { date: '2022年10月', price: 50.36 },
  { date: '2022年11月', price: 43.27 },
  { date: '2023年5月', price: 117.47 },
  { date: '2023年6月', price: 43.37 },
  { date: '2023年7月', price: 30.72 },
  { date: '2023年8月', price: 37.49 },
  { date: '2023年9月', price: 35.52 },
  { date: '2023年10月', price: 40.9 },
  { date: '2023年11月', price: 56.22 },
  { date: '2024年5月', price: 75.25 },
  { date: '2024年6月', price: 46.63 },
  { date: '2024年7月', price: 36.59 },
  { date: '2024年8月', price: 50.44 },
  { date: '2024年9月', price: 60.93 },
  { date: '2024年10月', price: 51.43 },
  { date: '2024年11月', price: 49.8 }
];

db.serialize(() => {
  db.run(`CREATE TABLE IF NOT EXISTS DragonFruitPrice (
    name TEXT,
    date TEXT,
    price REAL
  )`);

  const stmt = db.prepare('INSERT INTO DragonFruitPrice (name, date, price) VALUES (?, ?, ?)');
  data.forEach(item => {
    stmt.run('紅龍果', item.date, item.price);
  });
  stmt.finalize();
});

module.exports = db;

